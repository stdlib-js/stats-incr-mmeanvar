{
  "version": 3,
  "sources": ["../lib/main.js", "../lib/index.js"],
  "sourcesContent": ["/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar isPositiveInteger = require( '@stdlib/assert-is-positive-integer' ).isPrimitive;\nvar isArrayLike = require( '@stdlib/assert-is-array-like-object' );\nvar isnan = require( '@stdlib/math-base-assert-is-nan' );\nvar Float64Array = require( '@stdlib/array-float64' );\nvar format = require( '@stdlib/string-format' );\n\n\n// MAIN //\n\n/**\n* Returns an accumulator function which incrementally computes a moving arithmetic mean and unbiased sample variance.\n*\n* ## Method\n*\n* -   Let \\\\(W\\\\) be a window of \\\\(N\\\\) elements over which we want to compute an unbiased sample variance.\n*\n* -   The difference between the unbiased sample variance in a window \\\\(W_i\\\\) and the unbiased sample variance in a window \\\\(W_{i+1})\\\\) is given by\n*\n*     ```tex\n*     \\Delta s^2 = s_{i+1}^2 - s_{i}^2\n*     ```\n*\n* -   If we multiply both sides by \\\\(N-1\\\\),\n*\n*     ```tex\n*     (N-1)(\\Delta s^2) = (N-1)s_{i+1}^2 - (N-1)s_{i}^2\n*     ```\n*\n* -   If we substitute the definition of the unbiased sample variance having the form\n*\n*     ```tex\n*     \\begin{align*}\n*     s^2 &= \\frac{1}{N-1} \\biggl( \\sum_{i=1}^{N} (x_i - \\bar{x})^2 \\biggr) \\\\\n*         &= \\frac{1}{N-1} \\biggl( \\sum_{i=1}^{N} (x_i^2 - 2\\bar{x}x_i + \\bar{x}^2) \\biggr) \\\\\n*         &= \\frac{1}{N-1} \\biggl( \\sum_{i=1}^{N} x_i^2 - 2\\bar{x} \\sum_{i=1}^{N} x_i + \\sum_{i=1}^{N} \\bar{x}^2) \\biggr) \\\\\n*         &= \\frac{1}{N-1} \\biggl( \\sum_{i=1}^{N} x_i^2 - \\frac{2N\\bar{x}\\sum_{i=1}^{N} x_i}{N} + N\\bar{x}^2 \\biggr) \\\\\n*         &= \\frac{1}{N-1} \\biggl( \\sum_{i=1}^{N} x_i^2 - 2N\\bar{x}^2 + N\\bar{x}^2 \\biggr) \\\\\n*         &= \\frac{1}{N-1} \\biggl( \\sum_{i=1}^{N} x_i^2 - N\\bar{x}^2 \\biggr)\n*     \\end{align*}\n*     ```\n*\n*     we return\n*\n*     ```tex\n*     (N-1)(\\Delta s^2) = \\biggl(\\sum_{k=1}^N x_k^2 - N\\bar{x}_{i+1}^2 \\biggr) - \\biggl(\\sum_{k=0}^{N-1} x_k^2 - N\\bar{x}_{i}^2 \\biggr)\n*     ```\n*\n* -   This can be further simplified by recognizing that subtracting the sums reduces to \\\\(x_N^2 - x_0^2\\\\); in which case,\n*\n*     ```tex\n*     \\begin{align*}\n*     (N-1)(\\Delta s^2) &= x_N^2 - x_0^2 - N\\bar{x}_{i+1}^2 + N\\bar{x}_{i}^2 \\\\\n*     &= x_N^2 - x_0^2 - N(\\bar{x}_{i+1}^2 - \\bar{x}_{i}^2) \\\\\n*     &= x_N^2 - x_0^2 - N(\\bar{x}_{i+1} - \\bar{x}_{i})(\\bar{x}_{i+1} + \\bar{x}_{i})\n*     \\end{align*}\n*     ```\n*\n* -   Recognizing that the difference of means can be expressed\n*\n*     ```tex\n*     \\bar{x}_{i+1} - \\bar{x}_i = \\frac{1}{N} \\biggl( \\sum_{k=1}^N x_k - \\sum_{k=0}^{N-1} x_k \\biggr) = \\frac{x_N - x_0}{N}\n*     ```\n*\n*     and substituting into the equation above\n*\n*     ```tex\n*     (N-1)(\\Delta s^2) = x_N^2 - x_0^2 - (x_N - x_0)(\\bar{x}_{i+1} + \\bar{x}_{i})\n*     ```\n*\n* -   Rearranging terms gives us the update equation\n*\n*     ```tex\n*     \\begin{align*}\n*     (N-1)(\\Delta s^2) &= (x_N - x_0)(x_N + x_0) - (x_N - x_0)(\\bar{x}_{i+1} + \\bar{x}_{i})\n*     &= (x_N - x_0)(x_N + x_0 - \\bar{x}_{i+1} - \\bar{x}_{i}) \\\\\n*     &= (x_N - x_0)(x_N - \\bar{x}_{i+1} + x_0 - \\bar{x}_{i})\n*     \\end{align*}\n*     ```\n*\n* @param {Collection} [out] - output array\n* @param {PositiveInteger} window - window size\n* @throws {TypeError} output argument must be array-like\n* @throws {TypeError} window size must be a positive integer\n* @returns {Function} accumulator function\n*\n* @example\n* var accumulator = incrmmeanvar( 3 );\n*\n* var v = accumulator();\n* // returns null\n*\n* v = accumulator( 2.0 );\n* // returns [ 2.0, 0.0 ]\n*\n* v = accumulator( -5.0 );\n* // returns [ -1.5, 24.5 ]\n*\n* v = accumulator( 3.0 );\n* // returns [ 0.0, 19.0 ]\n*\n* v = accumulator( 5.0 );\n* // returns [ 1.0, 28.0 ]\n*\n* v = accumulator();\n* // returns [ 1.0, 28.0 ]\n*/\nfunction incrmmeanvar( out, window ) {\n\tvar meanvar;\n\tvar delta;\n\tvar buf;\n\tvar tmp;\n\tvar M2;\n\tvar mu;\n\tvar d1;\n\tvar d2;\n\tvar W;\n\tvar N;\n\tvar n;\n\tvar i;\n\tif ( arguments.length === 1 ) {\n\t\tmeanvar = [ 0.0, 0.0 ];\n\t\tW = out;\n\t} else {\n\t\tif ( !isArrayLike( out ) ) {\n\t\t\tthrow new TypeError( format( 'invalid argument. Output argument must be an array-like object. Value: `%s`.', out ) );\n\t\t}\n\t\tmeanvar = out;\n\t\tW = window;\n\t}\n\tif ( !isPositiveInteger( W ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. Window size must be a positive integer. Value: `%s`.', W ) );\n\t}\n\tbuf = new Float64Array( W );\n\tn = W - 1;\n\tM2 = 0.0;\n\tmu = 0.0;\n\ti = -1;\n\tN = 0;\n\n\treturn accumulator;\n\n\t/**\n\t* If provided a value, the accumulator function returns updated accumulated values. If not provided a value, the accumulator function returns the current accumulated values.\n\t*\n\t* @private\n\t* @param {number} [x] - input value\n\t* @returns {(ArrayLikeObject|null)} output array or null\n\t*/\n\tfunction accumulator( x ) {\n\t\tvar k;\n\t\tvar v;\n\t\tif ( arguments.length === 0 ) {\n\t\t\tif ( N === 0 ) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tmeanvar[ 0 ] = mu;\n\t\t\tif ( N === 1 ) {\n\t\t\t\tif ( isnan( M2 ) ) {\n\t\t\t\t\tmeanvar[ 1 ] = NaN;\n\t\t\t\t} else {\n\t\t\t\t\tmeanvar[ 1 ] = 0.0;\n\t\t\t\t}\n\t\t\t} else if ( N < W ) {\n\t\t\t\tmeanvar[ 1 ] = M2 / (N-1);\n\t\t\t} else {\n\t\t\t\tmeanvar[ 1 ] = M2 / n;\n\t\t\t}\n\t\t\treturn meanvar;\n\t\t}\n\t\t// Update the index for managing the circular buffer:\n\t\ti = (i+1) % W;\n\n\t\t// Case: incoming value is NaN, the sliding second moment is automatically NaN...\n\t\tif ( isnan( x ) ) {\n\t\t\tN = W; // explicitly set to avoid `N < W` branch\n\t\t\tmu = NaN;\n\t\t\tM2 = NaN;\n\t\t}\n\t\t// Case: initial window...\n\t\telse if ( N < W ) {\n\t\t\tbuf[ i ] = x; // update buffer\n\t\t\tN += 1;\n\t\t\tdelta = x - mu;\n\t\t\tmu += delta / N;\n\t\t\tM2 += delta * (x - mu);\n\n\t\t\tmeanvar[ 0 ] = mu;\n\t\t\tif ( N === 1 ) {\n\t\t\t\tmeanvar[ 1 ] = 0.0;\n\t\t\t} else {\n\t\t\t\tmeanvar[ 1 ] = M2 / (N-1);\n\t\t\t}\n\t\t\treturn meanvar;\n\t\t}\n\t\t// Case: N = W = 1\n\t\telse if ( N === 1 ) {\n\t\t\tmu = x;\n\t\t\tM2 = 0.0;\n\t\t\tmeanvar[ 0 ] = x;\n\t\t\tmeanvar[ 1 ] = 0.0;\n\t\t\treturn meanvar;\n\t\t}\n\t\t// Case: outgoing value is NaN, and, thus, we need to compute the accumulated values...\n\t\telse if ( isnan( buf[ i ] ) ) {\n\t\t\tN = 1;\n\t\t\tmu = x;\n\t\t\tM2 = 0.0;\n\t\t\tfor ( k = 0; k < W; k++ ) {\n\t\t\t\tif ( k !== i ) {\n\t\t\t\t\tv = buf[ k ];\n\t\t\t\t\tif ( isnan( v ) ) {\n\t\t\t\t\t\tN = W; // explicitly set to avoid `N < W` branch\n\t\t\t\t\t\tmu = NaN;\n\t\t\t\t\t\tM2 = NaN;\n\t\t\t\t\t\tbreak; // second moment is automatically NaN, so no need to continue\n\t\t\t\t\t}\n\t\t\t\t\tN += 1;\n\t\t\t\t\tdelta = v - mu;\n\t\t\t\t\tmu += delta / N;\n\t\t\t\t\tM2 += delta * (v - mu);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Case: neither the current second moment nor the incoming value are NaN, so we need to update the accumulated values...\n\t\telse if ( isnan( M2 ) === false ) {\n\t\t\ttmp = buf[ i ];\n\t\t\tdelta = x - tmp;\n\t\t\td1 = tmp - mu;\n\t\t\tmu += delta / W;\n\t\t\td2 = x - mu;\n\t\t\tM2 += delta * (d1 + d2);\n\t\t}\n\t\t// Case: the current second moment is NaN, so nothing to do until the buffer no longer contains NaN values...\n\t\tbuf[ i ] = x;\n\n\t\tmeanvar[ 0 ] = mu;\n\t\tmeanvar[ 1 ] = M2 / n;\n\t\treturn meanvar;\n\t}\n}\n\n\n// EXPORTS //\n\nmodule.exports = incrmmeanvar;\n", "/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n/**\n* Compute a moving arithmetic mean and unbiased sample variance incrementally.\n*\n* @module @stdlib/stats-incr-mmeanvar\n*\n* @example\n* var incrmmeanvar = require( '@stdlib/stats-incr-mmeanvar' );\n*\n* var accumulator = incrmmeanvar( 3 );\n*\n* var v = accumulator();\n* // returns null\n*\n* v = accumulator( 2.0 );\n* // returns [ 2.0, 0.0 ]\n*\n* v = accumulator( -5.0 );\n* // returns [ -1.5, 24.5 ]\n*\n* v = accumulator( 3.0 );\n* // returns [ 0.0, 19.0 ]\n*\n* v = accumulator( 5.0 );\n* // returns [ 1.0, 28.0 ]\n*\n* v = accumulator();\n* // returns [ 1.0, 28.0 ]\n*/\n\n// MODULES //\n\nvar main = require( './main.js' );\n\n\n// EXPORTS //\n\nmodule.exports = main;\n"],
  "mappings": "uGAAA,IAAAA,EAAAC,EAAA,SAAAC,EAAAC,EAAA,cAsBA,IAAIC,EAAoB,QAAS,oCAAqC,EAAE,YACpEC,EAAc,QAAS,qCAAsC,EAC7DC,EAAQ,QAAS,iCAAkC,EACnDC,EAAe,QAAS,uBAAwB,EAChDC,EAAS,QAAS,uBAAwB,EAsG9C,SAASC,EAAcC,EAAKC,EAAS,CACpC,IAAIC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACJ,GAAK,UAAU,SAAW,EACzBX,EAAU,CAAE,EAAK,CAAI,EACrBQ,EAAIV,MACE,CACN,GAAK,CAACL,EAAaK,CAAI,EACtB,MAAM,IAAI,UAAWF,EAAQ,+EAAgFE,CAAI,CAAE,EAEpHE,EAAUF,EACVU,EAAIT,CACL,CACA,GAAK,CAACP,EAAmBgB,CAAE,EAC1B,MAAM,IAAI,UAAWZ,EAAQ,yEAA0EY,CAAE,CAAE,EAE5G,OAAAN,EAAM,IAAIP,EAAca,CAAE,EAC1BE,EAAIF,EAAI,EACRJ,EAAK,EACLC,EAAK,EACLM,EAAI,GACJF,EAAI,EAEGG,EASP,SAASA,EAAaC,EAAI,CACzB,IAAIC,EACAC,EACJ,GAAK,UAAU,SAAW,EACzB,OAAKN,IAAM,EACH,MAERT,EAAS,CAAE,EAAIK,EACVI,IAAM,EACLf,EAAOU,CAAG,EACdJ,EAAS,CAAE,EAAI,IAEfA,EAAS,CAAE,EAAI,EAELS,EAAID,EACfR,EAAS,CAAE,EAAII,GAAMK,EAAE,GAEvBT,EAAS,CAAE,EAAII,EAAKM,EAEdV,GAMR,GAHAW,GAAKA,EAAE,GAAKH,EAGPd,EAAOmB,CAAE,EACbJ,EAAID,EACJH,EAAK,IACLD,EAAK,QAGD,IAAKK,EAAID,EACb,OAAAN,EAAKS,CAAE,EAAIE,EACXJ,GAAK,EACLR,EAAQY,EAAIR,EACZA,GAAMJ,EAAQQ,EACdL,GAAMH,GAASY,EAAIR,GAEnBL,EAAS,CAAE,EAAIK,EACVI,IAAM,EACVT,EAAS,CAAE,EAAI,EAEfA,EAAS,CAAE,EAAII,GAAMK,EAAE,GAEjBT,EAGH,GAAKS,IAAM,EACf,OAAAJ,EAAKQ,EACLT,EAAK,EACLJ,EAAS,CAAE,EAAIa,EACfb,EAAS,CAAE,EAAI,EACRA,EAGH,GAAKN,EAAOQ,EAAKS,CAAE,CAAE,GAIzB,IAHAF,EAAI,EACJJ,EAAKQ,EACLT,EAAK,EACCU,EAAI,EAAGA,EAAIN,EAAGM,IACnB,GAAKA,IAAMH,EAAI,CAEd,GADAI,EAAIb,EAAKY,CAAE,EACNpB,EAAOqB,CAAE,EAAI,CACjBN,EAAID,EACJH,EAAK,IACLD,EAAK,IACL,KACD,CACAK,GAAK,EACLR,EAAQc,EAAIV,EACZA,GAAMJ,EAAQQ,EACdL,GAAMH,GAASc,EAAIV,EACpB,OAIQX,EAAOU,CAAG,IAAM,KACzBD,EAAMD,EAAKS,CAAE,EACbV,EAAQY,EAAIV,EACZG,EAAKH,EAAME,EACXA,GAAMJ,EAAQO,EACdD,EAAKM,EAAIR,EACTD,GAAMH,GAASK,EAAKC,IAGrB,OAAAL,EAAKS,CAAE,EAAIE,EAEXb,EAAS,CAAE,EAAIK,EACfL,EAAS,CAAE,EAAII,EAAKM,EACbV,CACR,CACD,CAKAT,EAAO,QAAUM,ICvNjB,IAAImB,EAAO,IAKX,OAAO,QAAUA",
  "names": ["require_main", "__commonJSMin", "exports", "module", "isPositiveInteger", "isArrayLike", "isnan", "Float64Array", "format", "incrmmeanvar", "out", "window", "meanvar", "delta", "buf", "tmp", "M2", "mu", "d1", "d2", "W", "N", "n", "i", "accumulator", "x", "k", "v", "main"]
}
